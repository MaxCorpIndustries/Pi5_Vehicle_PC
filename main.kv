#:import SlideTransition kivy.uix.screenmanager.SlideTransition

#:kivy 2.2.0

<MainLayout>:
    orientation: "vertical"

    ScreenManager:
        id: screen_manager
		transition: SlideTransition(duration=0.25)
		
        Screen:
			name: "cameras"
            BoxLayout:
                orientation: "vertical"
                spacing: 10
                padding: 10

                Label:
                    text: "Cameras"
                    font_size: 22
                    size_hint_y: None
                    height: '25dp'
                    text_size: self.size
                    halign: 'left'
                    valign: 'middle'

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                BoxLayout:
                    orientation: "horizontal"
                    spacing: 0
                    padding: 0
                    size_hint_y: 0.05
                    
                    RoundedButton:
                        icon_source: 'cameras.png'
                        on_release: app.on_start()
                        
                    RoundedButton:
                        icon_source: 'stop.png'
                        on_release: app.stopcamPreview()  
  
                BoxLayout:
                    orientation: 'horizontal'                             
                    FloatLayout:
                    
                        canvas.before:
                            Color:
                                rgba: 0.10, 0.10, 0.10, 1  # This will make the background solid red                
                            Rectangle:
                                pos: self.pos
                                size: self.size
                        
                        Image:
                            source: 'topdown.png' 
                            allow_stretch: False
                            fit_mode: "contain"
                            padding:10
                            keep_ratio: True 
                        
                        CameraButtons:
                            text:"1"
                            pos_hint: {'x': 0.7, 'top': 0.2 if app.icons_visible else 0.4}
                            on_release: 
                                app.toggle_all_icons()
                                root.toggle_layout()                                

                        CameraButtons:
                            text:"2"
                            pos_hint: {'x': 0.7, 'top': 0.85 if app.icons_visible else 0.6}
                            on_release: 
                                app.toggle_all_icons()
                                root.toggle_layout()   

                        CameraButtons:
                            text:"3"
                            pos_hint: {'x': 0.1 if app.icons_visible else 0.05, 'top': 0.5}
                            on_release: 
                                app.toggle_all_icons()
                                root.toggle_layout()                
               
                        CameraButtons:
                            text:"4"
                            pos_hint: {'x': 0.8, 'top': 0.5}
                            on_release: 
                                app.toggle_all_icons()
                                root.toggle_layout()                        
                                
                        CameraButtons:
                            text:"5"
                            pos_hint: {'x': 0.6 if app.icons_visible else 0.65, 'top': 0.5}
                            on_release: 
                                app.toggle_all_icons()
                                root.toggle_layout()     

                        CameraButtons:
                            text:"6"
                            pos_hint: {'x': 0.55, 'top': 0.7 if app.icons_visible else 0.55}
                            on_release: 
                                app.toggle_all_icons()
                                root.toggle_layout()       

                    BoxLayout:
						id: extra_layout
                        orientation: "vertical"
                        spacing: 0
                        padding: 0
                        size_hint_y: 0
                        size_hint_x: 0

                        BoxLayout:
                            orientation: "horizontal"
                            spacing: 0
                            padding: 0
                                                
                            RoundedButton:
                                icon_source: 'cameras.png'
                                on_release: app.on_start()
                                
                            RoundedButton:
                                icon_source: 'stop.png'
                                on_release: app.stopcamPreview()
                            

                            
                #BoxLayout:
                    #orientation: "horizontal"
                   # spacing: 5
                   # padding: 5
                   # size_hint_y: 1
                    
                    #KivyCamera:
                        #id: camera_view
                        #allow_stretch: True
                        #keep_ratio: True
                        #size_hint_y: 1

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

        Screen:
            name: "settings"
            BoxLayout:
                orientation: "vertical"
                spacing: 10
                padding: 10

                Label:
                    text: "Settings"
                    font_size: 22
                    size_hint_y: None
                    height: '25dp'
                    text_size: self.size
                    halign: 'left'
                    valign: 'middle'

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                Widget:  # spacer

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

        Screen:
            name: "about"
            BoxLayout:
                orientation: "vertical"
                spacing: 10
                padding: 10

                Label:
                    text: "About"
                    font_size: 22
                    size_hint_y: None
                    height: '25dp'
                    text_size: self.size
                    halign: 'left'
                    valign: 'middle'

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                Widget:  # spacer

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
    BoxLayout:
        size_hint_y: 0.15
        spacing: 30  # 20px horizontal spacing, 0px vertical
        padding: 45, 2 # 10px padding on left/right, 0px top/bottom

        RoundedButton:
			icon_source: 'cameras.png'
            on_release: app.switch_screen("cameras")

        RoundedButton:
			icon_source: 'setting.png'
            on_release: app.switch_screen("settings")

        RoundedButton:
			icon_source: 'car.png'
            on_release: app.switch_screen("about")

        RoundedButton:
			icon_source: 'testsquare.png'
            on_release: app.switch_screen("about")
			

        RoundedButton:
            text: "Ã—"
			bold: True
            font_size: 64
			halign: 'center'
			valign: 'center'
            size_hint_x: 0.5
            on_release: app.stop()


# ----------------- CUSTOM ROUNDED BUTTON -----------------
<RoundedButton@Button>:
    text: ""
    radius: [30]  # default radius
    #width: '80dp'
    size_hint_x: 1
    bold: True
	color: 1, 1, 1, 1
	normal_color: 0, 0, 0, 1
	down_color: 0.8, 0.8, 0.8, 1
	
	icon_source: ""           # path to icon image
	icon_color: 1, 1, 1, 1  # RGBA color to tint icon

    background_color: 0, 0, 0, 0
    background_normal: ""

    size_x_test:10
    size_y_test:1

    canvas.before:
        Color:
            rgba: self.state == "down" and self.down_color or self.normal_color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: self.radius if self.radius else [14]  # safe fallback

    BoxLayout:
        orientation: "horizontal"
        padding: 0
        spacing: 0
        center_y: self.parent.center_y
        center_x: self.parent.center_x

        # Icon image
        Image:
            source: root.icon_source if root.icon_source else ""  # show nothing if no icon
            size_hint: root.size_x_test,root.size_y_test
            #size: self.size
            allow_stretch: True
            opacity: 1 if root.icon_source else 0
			color: root.icon_color if root.icon_color else (1, 1, 1, 1)
     

<CameraButtons@Button>:
    text: ""
    radius: [30] if app.icons_visible else [5]
    #width: '80dp'
    text_size: self.size
    font_size: '32sp'
    padding:10
    
    size_hint_y: 0.2 if app.icons_visible else 0.15
    size_hint_x: 0.15 if app.icons_visible else 0.1
    
    bold: True
    
    halign: 'right'
    valign: 'center'
    
	color: 0, 0, 0, 1
	normal_color: 0, 1, 0, 1
	down_color: 0.8, 0.8, 0.8, 1
	
	icon_source: 'cameras.png'
	icon_color: 1, 1, 1, 1  # RGBA color to tint icon

    background_color: 0, 0, 0, 0
    background_normal: ""

    canvas.before:
        Color:
            rgba: self.state == "down" and self.down_color or self.normal_color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: self.radius if self.radius else [14]  # safe fallback
        #Triangle:
           # points:
             #   [
              #  self.x + self.width*2, self.y + self.height,  # Top-Right
             #   self.x + self.width*2, self.y,                # Bottom-Right
             #   self.x+50, self.center_y                       # Left Tip
            #    ]
    BoxLayout:
        orientation: "horizontal"
        padding: 0
        spacing: 0
        center_y: self.parent.center_y
        center_x: self.parent.center_x-20
        
        # Icon image
        Image:
            source: root.icon_source if root.icon_source else ""  # show nothing if no icon
            size_hint: None, None
            size: self.size
            opacity: 1.0 if app.icons_visible else 0.0
            allow_stretch: True
			color: root.icon_color if root.icon_color else (1, 1, 1, 1)
     
<Label>:
    font_name: "main_font.otf"
    
