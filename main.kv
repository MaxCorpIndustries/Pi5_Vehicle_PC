#:import SlideTransition kivy.uix.screenmanager.SlideTransition

#:kivy 2.2.0

<MainLayout>:
    orientation: "vertical"

    ScreenManager:
        id: screen_manager
		transition: SlideTransition(duration=0.25)
		
        Screen:
			name: "cameras"
            BoxLayout:
                orientation: "vertical"
                spacing: 10
                padding: 10

                Label:
                    text: "Cameras"
                    font_size: 22
                    size_hint_y: None
                    height: '25dp'
                    text_size: self.size
                    halign: 'left'
                    valign: 'middle'

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                BoxLayout:
                    orientation: "horizontal"
                    spacing: 50
                    size_hint_y: 0.1

                    RoundedButton:
                        text: 'Start All'
                        radius: [5]
                        font_size: 28
                        color: 0, 0, 0, 1
                        normal_color: 0.1, 1, 0.1, 1
                        on_release: app.on_start()

                    RoundedButton:
                        text: 'Reset All'
                        radius: [5]
                        font_size: 28
                        color: 0, 0, 0, 1
                        normal_color: 1, 0.647, 0, 1
                        on_release: app.on_start()
                       
                    RoundedButton:
                        text: 'Stop All'
                        radius: [5]
                        font_size: 28                     
                        color: 0, 0, 0, 1
                        normal_color: 1, 0.1, 0.1, 1                        
                        on_release: app.stopcamPreview()  
  
                BoxLayout:
                    orientation: 'horizontal'                             
                    FloatLayout:
                    
                        canvas.before:
                            Color:
                                #rgba: 0.15, 0.15, 0.15, 1  # This will make the background solid red                
                                rgba: 0, 0, 0, 1  # This will make the background solid red                
                            Rectangle:
                                pos: self.pos
                                size: self.size
            
             
                        Image:
                            source: 'icons/topdown_tintable_body.png' 
                            color: app.carColor # This tints the image to solid green
                            allow_stretch: False
                            fit_mode: "contain"
                            padding:10
                            keep_ratio: True 

                        Image:
                            source: 'icons/topdown_tintable_shine.png' 
                            allow_stretch: False
                            fit_mode: "contain"
                            color: (1 - app.carColor[0]+app.carShineColorOffset, 1 - app.carColor[1]+app.carShineColorOffset, 1 - app.carColor[2]+app.carShineColorOffset, 1)
                            padding:10
                            keep_ratio: True      
            
                        Image:
                            source: 'icons/topdown_tintable_lights.png' 
                            allow_stretch: False
                            fit_mode: "contain"
                            padding:10
                            keep_ratio: True 
                       
                            
                        CameraButtons:
                            text:"1"
                            camera_id_string: "1_LEFTCAM"
                            pos_hint: {'x': 0.7, 'top': 0.2 if not self.disabled else 0.42}
                            on_release: 
                                root.toggle_layout(self,'screen_menu')  

                        CameraButtons:
                            text:"2"
                            camera_id_string: "2_RIGTCAM"
                            pos_hint: {'x': 0.7, 'top': 0.85 if not self.disabled else 0.6}
                            on_release: 
                                root.toggle_layout(self,'screen_menu')   

                        CameraButtons:
                            text:"3"
                            camera_id_string: "3_REARCAM"
                            pos_hint: {'x': 0.1 if not self.disabled else 0.05 , 'top': 0.5}
                            on_release: 
                                root.toggle_layout(self,'screen_menu')                
               
                        CameraButtons:
                            text:"4"
                            camera_id_string: "4_BMPRCAM"
                            pos_hint: {'x': 0.8 if not self.disabled else 0.7, 'top': 0.5}
                            on_release: 
                                root.toggle_layout(self,'screen_menu')                        
                                
                        CameraButtons:
                            text:"5"
                            camera_id_string: "5_DASHCAM"
                            pos_hint: {'x': 0.5, 'top': 0.5}
                            on_release: 
                                root.toggle_layout(self,'screen_menu')     

                        CameraButtons:
                            text:"6"
                            camera_id_string: "6_CLUSCAM"
                            pos_hint: {'x': 0.55, 'top': 0.7 if not self.disabled else 0.55}
                            on_release: 
                                root.toggle_layout(self,'screen_menu')       

                    BoxLayout:
						id: screen_menu
                        orientation: "vertical"
                        spacing: 0
                        padding: 0
                        size_hint_x: 0
                        opacity:0
                        
                        Label:
                            text: root.menu_text if app.root else "[NO DATA]"
                            font_size: 30     
                            padding: 10
                            text_size: self.size
                            size_hint_y:0.12
                            halign: 'center'
                            valign: 'middle'

                        Widget:
                            size_hint_y: None
                            height: 2
                            canvas:
                                Color:
                                    rgb: 1, 1, 1
                                Rectangle:
                                    pos: self.pos
                                    size: self.size
                            
                        BoxLayout:
                            orientation: "horizontal"
                            spacing: 0
                            padding: 0   
                            size_hint_y:1
                            
                        BoxLayout:
                            orientation: "horizontal"
                            spacing: 0
                            padding: 0   
                            size_hint_y:0.15
                                   
                            RoundedButton:
                                icon_source: 'icons/cameras_button.png'
                                on_release: app.on_start()
                                
                            RoundedButton:
                                icon_source: 'icons/stop.png'
                                on_release: app.stopcamPreview()
                            
                            RoundedButton:
                                #icon_source: 'stop.png'
                                text: "×"
                                bold: True
                                font_size: 64
                                halign: 'center'
                                valign: 'center'
                                size_hint_x: 0.5                                
                                on_release: 
                                    root.toggle_layout(self,'screen_menu') 
                            
                #BoxLayout:
                    #orientation: "horizontal"
                   # spacing: 5
                   # padding: 5
                   # size_hint_y: 1
                    
                    #KivyCamera:
                        #id: camera_view
                        #allow_stretch: True
                        #keep_ratio: True
                        #size_hint_y: 1

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

        Screen:
            name: "settings"
            BoxLayout:
                orientation: "vertical"
                spacing: 10
                padding: 10

                Label:
                    text: "Settings"
                    font_size: 22
                    size_hint_y: None
                    height: '25dp'
                    text_size: self.size
                    halign: 'left'
                    valign: 'middle'

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                BoxLayout:
                    orientation: "horizontal"
                    spacing: 0
                    padding: 0   
                    #size_hint_y: 1       
                    ScrollView:
                        do_scroll_x: False
                        do_scroll_y: True                    
                        GridLayout:
                            #orientation: "vertical"
                            spacing: 10
                            padding: 10   
                            size_hint_x: 1
                            size_hint_y: 1
                            row_force_default: True                        
                            cols: 1
                            
                            RoundedButton:
                                #icon_source: 'stop.png'
                                text: "Car Color"
                                #bold: True
                                halign: 'left'
                                #valign: 'center'
                                #size_hint_x: 1
                                on_release: 
                                    root.toggle_layout(self,'car_color_page') 

                            RoundedButton:
                                #icon_source: 'stop.png'
                                text: "test 1"
                                #bold: True
                                halign: 'left'
                                #valign: 'center'
                                #size_hint_x: 1
                                on_release: 
                                    root.toggle_layout(self,'car_color_page') 

                            RoundedButton:
                                #icon_source: 'stop.png'
                                text: "test 2"
                                #bold: True
                                halign: 'left'
                                #valign: 'center'
                                #size_hint_x: 1
                                on_release: 
                                    root.toggle_layout(self,'car_color_page') 

                    BoxLayout:
                        id:car_color_page
                        orientation: "vertical"
                        spacing: 0
                        padding: 0  
                        opacity:0                        
                        size_hint_x: 0                  

                        ColorPicker:
                            id: color_picker
                            color: 0.37, 0.37, 0.37, 0.37
                            # Bind the color change to a function in Python
                            on_color: app.carColor = self.color

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                            
        Screen:
            name: "about"
            BoxLayout:
                orientation: "vertical"
                spacing: 10
                padding: 10

                Label:
                    text: "This Vehicle"
                    font_size: 22
                    size_hint_y: None
                    height: '25dp'
                    text_size: self.size
                    halign: 'left'
                    valign: 'middle'

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                Image:
                    source: 'kivy_testing/testgif.gif' 
                    allow_stretch: False
                    fit_mode: "contain"
                    padding:10
                    keep_ratio: True 

                Widget:  # spacer

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size                            

        Screen:
            name: "music"
            BoxLayout:
                orientation: "vertical"
                spacing: 10
                padding: 10

                Label:
                    text: "Offline Music Player"
                    font_size: 22
                    size_hint_y: None
                    height: '25dp'
                    text_size: self.size
                    halign: 'left'
                    valign: 'middle'

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                Widget:  # spacer

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                            
        Screen:
            name: "knight"
            BoxLayout:
                orientation: "vertical"
                spacing: 10
                padding: 10

                Label:
                    text: "Knight Industries Vehicle Voice Asist"
                    font_size: 22
                    size_hint_y: None
                    height: '25dp'
                    text_size: self.size
                    halign: 'left'
                    valign: 'middle'

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                Widget:  # spacer

                Widget:
                    size_hint_y: None
                    height: 2
                    canvas:
                        Color:
                            rgb: 1, 1, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size
                            
    BoxLayout:
        size_hint_y: 0.15
        spacing: 30  # 20px horizontal spacing, 0px vertical
        padding: 45, 2 # 10px padding on left/right, 0px top/bottom

        RoundedButton:
			icon_source: 'icons/cameras_button.png'
            on_release: app.switch_screen("cameras")

        RoundedButton:
			icon_source: 'icons/car.png'
            on_release: app.switch_screen("about")

        RoundedButton:
			icon_source: 'icons/music.png'
            on_release: app.switch_screen("music")
			
        RoundedButton:
			icon_source: 'icons/knight.png'
            on_release: app.switch_screen("knight")

        RoundedButton:
			icon_source: 'icons/setting.png'
            on_release: app.switch_screen("settings")

        RoundedButton:
            text: "×"
			bold: True
            font_size: 64
            radius: [5] 
			halign: 'center'
			valign: 'center'
            size_hint_x: 0.25
            on_release: app.stop()


# ----------------- CUSTOM ROUNDED BUTTON -----------------
<RoundedButton@Button>:
    text: ""
    radius: [30]  # default radius
    #width: '80dp'
    size_hint_x: 1
    bold: True
	color: 1, 1, 1, 1
	normal_color: 0, 0, 0, 1
	down_color: 0.8, 0.8, 0.8, 1
	
	icon_source: ""           # path to icon image
	icon_color: 1, 1, 1, 1  # RGBA color to tint icon

    background_color: 0, 0, 0, 0
    background_normal: ""

    size_x_icon:10
    size_y_icon:1

    canvas.before:
        Color:
            rgba: self.state == "down" and self.down_color or self.normal_color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: self.radius if self.radius else [14]  # safe fallback

    BoxLayout:
        orientation: "horizontal"
        padding: 0
        spacing: 0
        center_y: self.parent.center_y
        center_x: self.parent.center_x

        # Icon image
        Image:
            source: root.icon_source if root.icon_source else ""  # show nothing if no icon
            size_hint: root.size_x_icon,root.size_y_icon
            #size: self.size
            allow_stretch: True
            opacity: 1 if root.icon_source else 0
            color: root.icon_color if root.icon_color else (1, 1, 1, 1)
     

<CameraButtons@Button>:
    text: ""
    radius: [30]
    #width: '80dp'
    text_size: self.size
    font_size: '32sp'
    padding:10
    
    opacity: 1
    
    #normal_color: [0.5, 0.5, 0.5, 1] # Default Gray
    down_color: [0.3, 0.3, 0.3, 1]   # Darker Gray
    camera_id_string: ""
    #normal_color: app.root.get_cam_color(self.camera_id_string) if self.camera_id_string != "" else [0.5, 0.5, 0.5, 1]
    normal_color: app.root.get_cam_color(self.camera_id_string) if (app.root and self.camera_id_string) else [0.5, 0.5, 0.5, 1]


    on_camera_id_string: if app.root: self.normal_color = app.root.get_cam_color(self.camera_id_string)
    
    size_hint_y: 0.15 if not self.disabled else 0.13    
    size_hint_x: 0.15 if not self.disabled else 0.28
    
    bold: True
    
    halign: 'right'
    valign: 'center'
    
	color: 0, 0, 0, 1
    disabled_color: self.color

	icon_source: 'icons/cameras.png'
	icon_color: 1, 1, 1, 1  # RGBA color to tint icon

    background_color: 0, 0, 0, 0
    background_normal: ""

    canvas.before:
        Color:
            rgba: self.normal_color if self.state == 'normal' else self.down_color
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: self.radius if self.radius else [14]  # safe fallback

    BoxLayout:
        orientation: "horizontal"
        padding: 0
        spacing: 0
        center_y: self.parent.center_y
        center_x: self.parent.center_x-20
        
        # Icon image
        Image:
            source: root.icon_source if root.icon_source else ""  # show nothing if no icon
            size_hint: None, None
            size: self.size
            opacity: 1 if not self.disabled else 0
            allow_stretch: True
            color: root.icon_color if root.icon_color else (1, 1, 1, 1)
     
<Label>:
    font_name: "main_font.otf"
    

